require('dotenv').config();

const mUmamiAbi = require('../test/abis/mumami');
const Web3 = require('web3');
const web3 = new Web3(
    new Web3.providers.WebsocketProvider('wss://arb-mainnet.g.alchemy.com/v2/nV81Jj6-GmCpG0TXJFEatqUZ0lJ3tLR3')
);
const bytecode = '0x610100604052732adabd6e8ce3e82f52d9998a7f64a90d294a92a473ffffffffffffffffffffffffffffffffffffffff1660809073ffffffffffffffffffffffffffffffffffffffff16815250731622bf67e6e5747b81866fe0b85178a93c7f86e373ffffffffffffffffffffffffffffffffffffffff1660a09073ffffffffffffffffffffffffffffffffffffffff168152507368b3465833fb72a70ecdf485e0e4c7bd8665fc4573ffffffffffffffffffffffffffffffffffffffff1660c09073ffffffffffffffffffffffffffffffffffffffff168152507382af49447d8a07e3bd95bd0d56f35241523fbab173ffffffffffffffffffffffffffffffffffffffff1660e09073ffffffffffffffffffffffffffffffffffffffff168152506040516200198738038062001987833981810160405281019062000146919062000a33565b620001666200015a6200085860201b60201c565b6200086060201b60201c565b600060805173ffffffffffffffffffffffffffffffffffffffff166370a08231336040518263ffffffff1660e01b8152600401620001a5919062000aaa565b60206040518083038186803b158015620001be57600080fd5b505afa158015620001d3573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190620001f9919062000a33565b905060805173ffffffffffffffffffffffffffffffffffffffff166323b872dd3330846040518463ffffffff1660e01b81526004016200023c9392919062000ad8565b602060405180830381600087803b1580156200025757600080fd5b505af11580156200026c573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000292919062000b52565b620002d4576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620002cb9062000be5565b60405180910390fd5b620003b06040518060400160405280600781526020017f62616c616e63650000000000000000000000000000000000000000000000000081525060805173ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b81526004016200034b919062000aaa565b60206040518083038186803b1580156200036457600080fd5b505afa15801562000379573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906200039f919062000a33565b6200092460201b620003811760201c565b60805173ffffffffffffffffffffffffffffffffffffffff16633ccfd60b6040518163ffffffff1660e01b8152600401600060405180830381600087803b158015620003fb57600080fd5b505af115801562000410573d6000803e3d6000fd5b50505050600060a05173ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b815260040162000453919062000aaa565b60206040518083038186803b1580156200046c57600080fd5b505afa15801562000481573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190620004a7919062000a33565b90508060a05173ffffffffffffffffffffffffffffffffffffffff16633e5beab960c0516040518263ffffffff1660e01b8152600401620004e9919062000aaa565b60206040518083038186803b1580156200050257600080fd5b505afa15801562000517573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906200053d919062000a33565b1015620005e75760a05173ffffffffffffffffffffffffffffffffffffffff1663095ea7b360c05169152d02c7e14af67fffff6040518363ffffffff1660e01b81526004016200058f92919062000c54565b602060405180830381600087803b158015620005aa57600080fd5b505af1158015620005bf573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190620005e5919062000b52565b505b600060405180610100016040528060a05173ffffffffffffffffffffffffffffffffffffffff16815260200160e05173ffffffffffffffffffffffffffffffffffffffff16815260200161271062ffffff1681526020013073ffffffffffffffffffffffffffffffffffffffff16815260200164174876e8008152602001838152602001858152602001600073ffffffffffffffffffffffffffffffffffffffff16815250905060c05173ffffffffffffffffffffffffffffffffffffffff1663414bf389826040518263ffffffff1660e01b8152600401620006cb919062000d86565b602060405180830381600087803b158015620006e657600080fd5b505af1158015620006fb573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000721919062000a33565b50600060e05173ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b815260040162000761919062000aaa565b60206040518083038186803b1580156200077a57600080fd5b505afa1580156200078f573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190620007b5919062000a33565b905060e05173ffffffffffffffffffffffffffffffffffffffff1663a9059cbb33836040518363ffffffff1660e01b8152600401620007f692919062000da4565b602060405180830381600087803b1580156200081157600080fd5b505af115801562000826573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906200084c919062000b52565b50505050505062000e98565b600033905090565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b620009c682826040516024016200093d92919062000e64565b6040516020818303038152906040527fb60e72cc000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050620009ca60201b60201c565b5050565b60008151905060006a636f6e736f6c652e6c6f679050602083016000808483855afa5050505050565b600080fd5b6000819050919050565b62000a0d81620009f8565b811462000a1957600080fd5b50565b60008151905062000a2d8162000a02565b92915050565b60006020828403121562000a4c5762000a4b620009f3565b5b600062000a5c8482850162000a1c565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600062000a928262000a65565b9050919050565b62000aa48162000a85565b82525050565b600060208201905062000ac1600083018462000a99565b92915050565b62000ad281620009f8565b82525050565b600060608201905062000aef600083018662000a99565b62000afe602083018562000a99565b62000b0d604083018462000ac7565b949350505050565b60008115159050919050565b62000b2c8162000b15565b811462000b3857600080fd5b50565b60008151905062000b4c8162000b21565b92915050565b60006020828403121562000b6b5762000b6a620009f3565b5b600062000b7b8482850162000b3b565b91505092915050565b600082825260208201905092915050565b7f7472616e73666572206661696c65640000000000000000000000000000000000600082015250565b600062000bcd600f8362000b84565b915062000bda8262000b95565b602082019050919050565b6000602082019050818103600083015262000c008162000bbe565b9050919050565b6000819050919050565b6000819050919050565b600062000c3c62000c3662000c308462000c07565b62000c11565b620009f8565b9050919050565b62000c4e8162000c1b565b82525050565b600060408201905062000c6b600083018562000a99565b62000c7a602083018462000c43565b9392505050565b62000c8c8162000a85565b82525050565b600062ffffff82169050919050565b62000cac8162000c92565b82525050565b62000cbd81620009f8565b82525050565b62000cce8162000a65565b82525050565b6101008201600082015162000ced600085018262000c81565b50602082015162000d02602085018262000c81565b50604082015162000d17604085018262000ca1565b50606082015162000d2c606085018262000c81565b50608082015162000d41608085018262000cb2565b5060a082015162000d5660a085018262000cb2565b5060c082015162000d6b60c085018262000cb2565b5060e082015162000d8060e085018262000cc3565b50505050565b60006101008201905062000d9e600083018462000cd4565b92915050565b600060408201905062000dbb600083018562000a99565b62000dca602083018462000ac7565b9392505050565b600081519050919050565b60005b8381101562000dfc57808201518184015260208101905062000ddf565b8381111562000e0c576000848401525b50505050565b6000601f19601f8301169050919050565b600062000e308262000dd1565b62000e3c818562000b84565b935062000e4e81856020860162000ddc565b62000e598162000e12565b840191505092915050565b6000604082019050818103600083015262000e80818562000e23565b905062000e91602083018462000ac7565b9392505050565b60805160a05160c05160e051610ab562000ed260003960006101b2015260006102db0152600061018e015260006101d90152610ab56000f3fe608060405234801561001057600080fd5b50600436106100935760003560e01c8063715018a611610066578063715018a61461010e5780638980f11f146101185780638da5cb5b14610134578063954ea66514610152578063f2fde38b1461017057610093565b8063052ae4d6146100985780633fc8cef3146100b65780635b49f386146100d45780635cec5b6c146100f0575b600080fd5b6100a061018c565b6040516100ad919061060f565b60405180910390f35b6100be6101b0565b6040516100cb919061064b565b60405180910390f35b6100ee60048036038101906100e991906106a1565b6101d4565b005b6100f86101d7565b60405161010591906106ef565b60405180910390f35b6101166101fb565b005b610132600480360381019061012d9190610748565b61020f565b005b61013c6102b0565b6040516101499190610797565b60405180910390f35b61015a6102d9565b60405161016791906107d3565b60405180910390f35b61018a600480360381019061018591906107ee565b6102fd565b005b7f000000000000000000000000000000000000000000000000000000000000000081565b7f000000000000000000000000000000000000000000000000000000000000000081565b50565b7f000000000000000000000000000000000000000000000000000000000000000081565b61020361041d565b61020d600061049b565b565b61021761041d565b8173ffffffffffffffffffffffffffffffffffffffff1663a9059cbb61023b6102b0565b836040518363ffffffff1660e01b815260040161025992919061082a565b602060405180830381600087803b15801561027357600080fd5b505af1158015610287573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102ab919061088b565b505050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b7f000000000000000000000000000000000000000000000000000000000000000081565b61030561041d565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161415610375576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161036c9061093b565b60405180910390fd5b61037e8161049b565b50565b61041982826040516024016103979291906109e3565b6040516020818303038152906040527fb60e72cc000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff838183161783525050505061055f565b5050565b610425610588565b73ffffffffffffffffffffffffffffffffffffffff166104436102b0565b73ffffffffffffffffffffffffffffffffffffffff1614610499576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161049090610a5f565b60405180910390fd5b565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b60008151905060006a636f6e736f6c652e6c6f679050602083016000808483855afa5050505050565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b60006105d56105d06105cb84610590565b6105b0565b610590565b9050919050565b60006105e7826105ba565b9050919050565b60006105f9826105dc565b9050919050565b610609816105ee565b82525050565b60006020820190506106246000830184610600565b92915050565b6000610635826105dc565b9050919050565b6106458161062a565b82525050565b6000602082019050610660600083018461063c565b92915050565b600080fd5b6000819050919050565b61067e8161066b565b811461068957600080fd5b50565b60008135905061069b81610675565b92915050565b6000602082840312156106b7576106b6610666565b5b60006106c58482850161068c565b91505092915050565b60006106d9826105dc565b9050919050565b6106e9816106ce565b82525050565b600060208201905061070460008301846106e0565b92915050565b600061071582610590565b9050919050565b6107258161070a565b811461073057600080fd5b50565b6000813590506107428161071c565b92915050565b6000806040838503121561075f5761075e610666565b5b600061076d85828601610733565b925050602061077e8582860161068c565b9150509250929050565b6107918161070a565b82525050565b60006020820190506107ac6000830184610788565b92915050565b60006107bd826105dc565b9050919050565b6107cd816107b2565b82525050565b60006020820190506107e860008301846107c4565b92915050565b60006020828403121561080457610803610666565b5b600061081284828501610733565b91505092915050565b6108248161066b565b82525050565b600060408201905061083f6000830185610788565b61084c602083018461081b565b9392505050565b60008115159050919050565b61086881610853565b811461087357600080fd5b50565b6000815190506108858161085f565b92915050565b6000602082840312156108a1576108a0610666565b5b60006108af84828501610876565b91505092915050565b600082825260208201905092915050565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b60006109256026836108b8565b9150610930826108c9565b604082019050919050565b6000602082019050818103600083015261095481610918565b9050919050565b600081519050919050565b60005b83811015610984578082015181840152602081019050610969565b83811115610993576000848401525b50505050565b6000601f19601f8301169050919050565b60006109b58261095b565b6109bf81856108b8565b93506109cf818560208601610966565b6109d881610999565b840191505092915050565b600060408201905081810360008301526109fd81856109aa565b9050610a0c602083018461081b565b9392505050565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b6000610a496020836108b8565b9150610a5482610a13565b602082019050919050565b60006020820190508181036000830152610a7881610a3c565b905091905056fea26469706673582212208f48f8cc78c1ded7001149967bb49ee5e9ff757088a52028b6c5cc3af6c226d464736f6c63430008090033';
const chainId = 42161; // Arbitrum
const mUmami = new web3.eth.Contract(
    mUmamiAbi,
    '0x2AdAbD6E8Ce3e82f52d9998a7f64a90d294A92A4'
);

const privateKey = process.env.privateKey;
const publicAddress = process.env.publicAddress;

const account = {
    privateKey: privateKey,
    address: publicAddress
}

// might need to be http provider?




let checkDumpability = async() => {
    web3.eth.subscribe('newBlockHeaders').on('data', async block => {
        console.log(`New block received. Block # ${block.number}`);
        let dumpable = await mUmami.methods.withdrawEnabled().call();
        console.log('Dumpability: ' + dumpable);

        if (dumpable === true) {
            await dropTheLoad();
        }
    });
}
async function dropTheLoad() {
    // send transaction
    let number
    while (true) {
        console.log(number++)
    }

}
checkDumpability();